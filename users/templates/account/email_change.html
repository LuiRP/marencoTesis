{% extends "layouts/base.html" %}
{% load i18n %}
{% load allauth %}
{% block title %}
    Cambiar correo electrónico
{% endblock title %}
{% block content %}
    <div class="h-100 d-flex flex-column gap-md-4 gap-2">
        <c-card_basic class="h-auto d-flex flex-column gap-2 justify-content-between">
        <div class="d-flex flex-row justify-content-between align-items-center">
            <div class="d-flex w-100">
                <div class="d-flex flex-grow-1">
                    <h3 class="lead m-2">Cambiar correo electrónico</h3>
                </div>
            </div>
        </div>
        </c-card_basic>
        {% if not emailaddresses %}
            {% include "account/snippets/warn_no_email.html" %}
        {% endif %}
        {% url 'account_email' as action_url %}
        <c-form.form method="post" action="{{ action_url }}">
        {% csrf_token %}
        <!-- Current email display -->
        {% if current_emailaddress %}
            <div class="mb-3">
                <label class="form-label">{% translate "Current email" %}:</label>
                <div class="form-control" disabled>{{ current_emailaddress.email }}</div>
            </div>
        {% endif %}
        <!-- Pending email display -->
        {% if new_emailaddress %}
            <div class="mb-3">
                <label class="form-label">
                    {% if not current_emailaddress %}
                        {% translate "Current email" %}:
                    {% else %}
                        {% translate "Changing to" %}:
                    {% endif %}
                </label>
                <div class="form-control" disabled>{{ new_emailaddress.email }}</div>
            </div>
        {% endif %}
        <!-- New email input -->
        <c-form.form-control :field="form.email" />
        <button type="submit"
                name="action_add"
                class="btn text-white d-flex justify-content-center align-items-center gap-1 btn-primary">
            <span>{% trans "Change Email" %}</span>
        </button>
        </c-form.form>
        {% if new_emailaddress %}
            <!-- Pending email actions - only show when there's a pending email -->
            <div class="card p-2 d-flex gap-2 shadow-sm border-0">
                <div class="form-text mt-2">
                    {% blocktranslate %}Your email address is still pending verification.{% endblocktranslate %}
                </div>
                <button form="pending-email"
                        type="submit"
                        name="action_send"
                        class="btn btn-outline-secondary btn-sm">{% trans 'Re-send Verification' %}</button>
                {% if current_emailaddress %}
                    <button form="pending-email"
                            type="submit"
                            name="action_remove"
                            class="btn btn-outline-danger btn-sm">{% trans 'Cancel Change' %}</button>
                {% endif %}
            </div>
            <!-- Hidden form for pending email actions -->
            <form style="display: none"
                  id="pending-email"
                  method="post"
                  action="{% url 'account_email' %}">
                {% csrf_token %}
                <input type="hidden" name="email" value="{{ new_emailaddress.email }}">
            </form>
        {% endif %}
    </div>
{% endblock content %}
